# RVIM ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

RVIMã¯ **Rust-idiomaticè¨­è¨ˆ** ã¨ **TDD (Test-Driven Development)** ã®åŸå‰‡ã«åŸºã¥ã„ã¦è¨­è¨ˆã•ã‚ŒãŸVIMãƒ©ã‚¤ã‚¯ã‚¨ãƒ‡ã‚£ã‚¿ã§ã™ã€‚Clean Architectureã®è¦ç´ ã‚’å–ã‚Šå…¥ã‚Œã¤ã¤ã€Rustã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸã‚·ãƒ³ãƒ—ãƒ«ã§å®Ÿç”¨çš„ãªè¨­è¨ˆã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              main.rs                â”‚ â† ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ + Editorçµ±åˆ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               vim/                  â”‚ â† VIMæ©Ÿèƒ½å±¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   KeyMapper   â”‚ â”‚  CommandEngine  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        ModeManager                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              editor/                â”‚ â† ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ã‚¢å±¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Buffer    â”‚ â”‚    Position     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               io/                   â”‚ â† I/Oå±¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FileSystem  â”‚ â”‚   Terminal      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             error.rs                â”‚ â† çµ±ä¸€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ main.rs                    # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ lib.rs                     # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¯ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ error.rs                   # ã‚¨ãƒ©ãƒ¼å®šç¾©
â”œâ”€â”€ editor/                    # ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ã‚¢å±¤
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ buffer.rs             # ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ç®¡ç†
â”‚   â””â”€â”€ cursor.rs             # ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ç®¡ç†
â”œâ”€â”€ vim/                       # VIMæ©Ÿèƒ½å±¤
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ mode.rs               # ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ï¼ˆNormal/Insert/Visual/Commandï¼‰
â”‚   â”œâ”€â”€ command.rs            # VIMã‚³ãƒãƒ³ãƒ‰å®šç¾©ãƒ»å®Ÿè¡Œ
â”‚   â””â”€â”€ keymap.rs             # ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°è§£æ
â””â”€â”€ io/                        # I/Oå±¤
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ fs.rs                 # ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ
    â””â”€â”€ terminal.rs           # ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œ
```

## ğŸ¯ è¨­è¨ˆåŸå‰‡

### 1. Rust-idiomaticè¨­è¨ˆ

Rustã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸè‡ªç„¶ãªè¨­è¨ˆã‚’æ¡ç”¨ï¼š

```rust
// æ‰€æœ‰æ¨©ã‚’æ´»ç”¨ã—ãŸãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§
pub struct Buffer {
    lines: Vec<String>,
    modified: bool,
    undo_stack: Vec<Action>,
}

// Copy traitã«ã‚ˆã‚‹è»½é‡ãªPosition
#[derive(Debug, Clone, Copy, PartialEq, Eq)]
pub struct Position {
    pub row: usize,
    pub col: usize,
}

// Resultã«ã‚ˆã‚‹æ˜ç¤ºçš„ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
pub fn save_to_file(&self, path: &Path) -> Result<(), RvimError>
```

### 2. å˜ä¸€è²¬ä»»ã®åŸå‰‡ (SRP)

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯**ä¸€ã¤ã®è²¬ä»»**ã®ã¿ã‚’æŒã¤ï¼š

- `editor/buffer.rs`: ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒãƒ•ã‚¡ã®ç®¡ç†ã®ã¿
- `editor/cursor.rs`: ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®è¨ˆç®—ã®ã¿  
- `vim/mode.rs`: ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ã®ç®¡ç†ã®ã¿
- `vim/keymap.rs`: ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®è§£æã®ã¿
- `vim/command.rs`: VIMã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œã®ã¿

### 3. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢ã¨ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£

æ©Ÿèƒ½ã”ã¨ã«æ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã€ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½ï¼š

```rust
// å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆå¯èƒ½
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_buffer_operations() {
        let mut buffer = Buffer::new();
        buffer.insert_text(0, 0, "Hello");
        assert_eq!(buffer.get_line(0), Some("Hello"));
    }
}
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ã‚­ãƒ¼å…¥åŠ›ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›] 
    â†“
[io/terminal.rs::read_key()] 
    â†“
[vim/keymap.rs::parse_key()] 
    â†“
[vim/command.rs::execute()] 
    â†“
[editor/] (buffer.rs, cursor.rs)
    â†“
[io/terminal.rs::render()]
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ•ãƒ­ãƒ¼

```
[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒãƒ³ãƒ‰ :w]
    â†“
[vim/keymap.rs::parse_command()]
    â†“
[vim/command.rs::SaveFile]
    â†“
[io/fs.rs::write_file()]
    â†“
[ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ]
```

### 3. ã‚¨ãƒ‡ã‚£ã‚¿çŠ¶æ…‹ç®¡ç†ãƒ•ãƒ­ãƒ¼

```
[Editor State] (main.rs)
    â”œâ”€â”€ buffer: Buffer (editor/buffer.rs)
    â”œâ”€â”€ cursor: Position (editor/cursor.rs)  
    â”œâ”€â”€ mode: ModeManager (vim/mode.rs)
    â”œâ”€â”€ key_mapper: KeyMapper (vim/keymap.rs)
    â””â”€â”€ terminal: Terminal (io/terminal.rs)
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰

```
     ğŸ”º
    E2E        â† å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ†ã‚¹ãƒˆï¼ˆå°‘æ•°ï¼‰
   â”€â”€â”€â”€â”€
  Integration  â† ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€£æºãƒ†ã‚¹ãƒˆï¼ˆä¸­ç¨‹åº¦ï¼‰
 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Unit Tests     â† å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå¤šæ•°ï¼‰
```

### å®Ÿéš›ã®å®Ÿè£…çŠ¶æ³

#### 1. å˜ä½“ãƒ†ã‚¹ãƒˆ (Unit Tests) - 119ãƒ†ã‚¹ãƒˆ
- **å¯¾è±¡**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ç´”ç²‹é–¢æ•°
- **ç‰¹å¾´**: é«˜é€Ÿã€ç‹¬ç«‹ã€æ±ºå®šçš„
- **å®Ÿè£…ä¾‹**: `Position::move_right()`, `Buffer::insert_text()`

```rust
#[test]
fn test_cursor_move_right() {
    let position = Position::new(0, 0);
    let new_position = position.move_right(10);
    assert_eq!(new_position.col, 1);
}
```

#### 2. çµ±åˆãƒ†ã‚¹ãƒˆ (Integration Tests) 
- **å¯¾è±¡**: VIMã‚³ãƒãƒ³ãƒ‰ã¨ç·¨é›†æ©Ÿèƒ½ã®é€£æº
- **ç‰¹å¾´**: å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“é€£æº
- **å®Ÿè£…ä¾‹**: `vim/tests/`, `editor/tests/`

```rust
#[test]
fn test_vim_editing_integration() {
    let mut buffer = Buffer::new();
    let position = Position::new(0, 0);
    
    // VIMã‚³ãƒãƒ³ãƒ‰ã®çµ±åˆãƒ†ã‚¹ãƒˆ
    let result = execute_vim_command(&mut buffer, VimCommand::InsertChar('H'));
    assert!(result.is_ok());
}
```

## ğŸš€ æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### 1. æ–°ã—ã„VIMã‚³ãƒãƒ³ãƒ‰ã®è¿½åŠ 

1. `vim/command.rs`ã®`VimCommand` enumã«æ–°ã—ã„ãƒãƒªã‚¢ãƒ³ãƒˆè¿½åŠ 
2. `vim/keymap.rs`ã«ã‚­ãƒ¼ãƒãƒƒãƒ”ãƒ³ã‚°è¿½åŠ 
3. `vim/command.rs`ã®`execute()`ã«å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
4. å¯¾å¿œã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 

### 2. æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ã‚µãƒãƒ¼ãƒˆ

1. `io/fs.rs`ã«æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œé–¢æ•°è¿½åŠ 
2. `editor/buffer.rs`ã«å½¢å¼å›ºæœ‰ã®èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯è¿½åŠ 
3. `error.rs`ã«æ–°ã—ã„ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—è¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
4. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 

### 3. æ–°ã—ã„UIæ©Ÿèƒ½ã®è¿½åŠ 

1. `io/terminal.rs`ã«æ–°ã—ã„æç”»ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
2. `main.rs`ã®æç”»ãƒ­ã‚¸ãƒƒã‚¯æ›´æ–°
3. ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³æ©Ÿèƒ½ã®æ‹¡å¼µ
4. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«æ“ä½œã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ 

## ğŸ“Š ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—

```
main.rs (Editor)
  â”œâ”€â”€ editor/buffer.rs
  â”œâ”€â”€ editor/cursor.rs  
  â”œâ”€â”€ vim/mode.rs
  â”œâ”€â”€ vim/keymap.rs
  â”œâ”€â”€ vim/command.rs
  â”œâ”€â”€ io/terminal.rs
  â”œâ”€â”€ io/fs.rs
  â””â”€â”€ error.rs

å†…éƒ¨ä¾å­˜é–¢ä¿‚:
vim/command.rs â†’ editor/ (Buffer, Position)
vim/keymap.rs â†’ vim/command.rs  
main.rs â†’ all modules
```

## ğŸ¯ è¨­è¨ˆæ±ºå®šã®è¨˜éŒ²

### 1. ãªãœRust-idiomaticè¨­è¨ˆã‚’æ¡ç”¨ã—ãŸã‹ï¼Ÿ

- **æ‰€æœ‰æ¨©ã‚·ã‚¹ãƒ†ãƒ **: Rustã®ç‰¹æ€§ã‚’æ´»ã‹ã—ãŸãƒ¡ãƒ¢ãƒªå®‰å…¨ãªè¨­è¨ˆ
- **ã‚·ãƒ³ãƒ—ãƒ«ã•**: Clean Architectureã®è¤‡é›‘ã•ã‚’é¿ã‘ã€å®Ÿç”¨æ€§ã‚’é‡è¦–
- **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢ã«ã‚ˆã‚‹å„ªã‚ŒãŸãƒ†ã‚¹ãƒˆå¯èƒ½æ€§

### 2. ãªãœTDDã‚’æ¡ç”¨ã—ãŸã‹ï¼Ÿ

- **å“è³ªä¿è¨¼**: 119ã®ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹é«˜ã„å“è³ªä¿è¨¼
- **ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®‰å…¨æ€§**: ãƒ†ã‚¹ãƒˆã«ã‚ˆã‚‹å®‰å…¨ãªã‚³ãƒ¼ãƒ‰å¤‰æ›´
- **ä»•æ§˜æ˜ç¢ºåŒ–**: ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã«ã‚ˆã‚‹è¦ä»¶ã®æ˜ç¢ºåŒ–

### 3. ãªãœãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†é›¢è¨­è¨ˆã‚’é¸ã‚“ã ã‹ï¼Ÿ

- **è²¬ä»»åˆ†é›¢**: å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒæ˜ç¢ºãªè²¬ä»»ã‚’æŒã¤
- **ä¿å®ˆæ€§**: å¤‰æ›´ã®å½±éŸ¿ç¯„å›²ã‚’é™å®š
- **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®æ—¢å­˜ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã‚’æœ€å°åŒ–

### 4. ãªãœRust 2024 Editionã‚’ä½¿ç”¨ã—ãŸã‹ï¼Ÿ

- **æœ€æ–°æ©Ÿèƒ½**: Rustã®æœ€æ–°ã®è¨€èªæ©Ÿèƒ½ã‚’æ´»ç”¨
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ™ãƒ«ã®é«˜é€Ÿå‹•ä½œ
- **å‹å®‰å…¨æ€§**: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ãƒã‚°æ¤œå‡ºã¨ãƒ¡ãƒ¢ãƒªå®‰å…¨æ€§

---

**RVIM Architecture** - Clean, Testable, Extensible ğŸ¦€